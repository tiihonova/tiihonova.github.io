!function(x){var f={idx_expanded:-1,sliceH:0,current:0,totalSlices:0},h={selectSlice:function(a,s,p,l,r){return x.Deferred(function(t){var e,d,c=a.data("expanded"),o=a.data("position"),i=s.not(a);c?(a.data("expanded",!1),f.idx_expanded=-1,e=f.sliceH,d=f.sliceH,a.find(".va-content").hide(),h.canSlideUp(s,r)?l.fadeIn():l.fadeOut(),h.canSlideDown(s,r)?p.fadeIn():p.fadeOut()):(a.data("expanded",!0),f.idx_expanded=a.index(),i.data("expanded",!1),e=r.expandedHeight,d=Math.ceil((r.accordionH-r.expandedHeight)/(r.visibleSlices-1)),0<f.idx_expanded?l.fadeIn():l.fadeOut(),f.idx_expanded<f.totalSlices-1?p.fadeIn():p.fadeOut());var n={height:e+"px",opacity:1,top:(o-1)*d+"px"};a.stop().animate(n,r.animSpeed,r.animEasing,function(){c||a.find(".va-content").fadeIn(r.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:f.sliceH+"px"},r.animSpeed,r.animEasing),i.each(function(e){var i,n=x(this),a=n.data("position");i=c?(a-1)*d:a<o?(a-1)*d:(a-2)*d+r.expandedHeight,n.stop().animate({top:i+"px",height:d+"px",opacity:c?1:r.animOpacity},r.animSpeed,r.animEasing,t.resolve).find(".va-title").stop().animate({lineHeight:d+"px"},r.animSpeed,r.animEasing).end().find(".va-content").hide()})}).promise()},navigate:function(e,i,n,a,t){if(i.is(":animated"))return!1;var d;-1==f.idx_expanded||t.savePositions?h.slide(e,i,n,a,t):(d=i.eq(f.idx_expanded),x.when(h.selectSlice(d,i,n,a,t)).done(function(){setTimeout(function(){h.slide(e,i,n,a,t)},10)}))},slide:function(d,e,i,n,c){if(-1!==f.idx_expanded&&c.savePositions){if(1===d&&f.idx_expanded===f.totalSlices-1)return!1;if(-1===d&&0===f.idx_expanded)return!1;-1===d&&1===f.idx_expanded?n.fadeOut():n.fadeIn(),1===d&&f.idx_expanded===f.totalSlices-2?i.fadeOut():i.fadeIn()}else{if(1===d&&f.current+c.visibleSlices>=f.totalSlices)return!1;if(-1===d&&0===f.current)return!1;-1===d&&1===f.current?n.fadeOut():n.fadeIn(),1===d&&f.current+c.visibleSlices===f.totalSlices-1?i.fadeOut():i.fadeIn()}var o,s,a=e.eq(f.idx_expanded);if(o=1===d?a.next():a.prev(),1===d&&!h.canSlideDown(e,c)||-1===d&&!h.canSlideUp(e,c))return h.selectSlice(o,e,i,n,c),!1;1===d?(f.current++,s="-="+f.sliceH,pos_increment=-1):(f.current--,s="+="+f.sliceH,pos_increment=1),e.each(function(e){var i,n,a=x(this),t=a.data("position");c.savePositions&&-1!==f.idx_expanded?e===o.index()?(a.data("expanded",!0),f.idx_expanded=a.index(),i=c.expandedHeight,n=(c.accordionH-c.expandedHeight)/(c.visibleSlices-1),a.stop().animate({height:i+"px",opacity:1,top:1===d?(t-2)*n+"px":t*n+"px"},c.animSpeed,c.animEasing,function(){a.find(".va-content").fadeIn(c.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:f.sliceH+"px"},c.animSpeed,c.animEasing)):a.data("expanded")?(a.data("expanded",!1),n=(c.accordionH-c.expandedHeight)/(c.visibleSlices-1),a.stop().animate({height:n+"px",opacity:c.animOpacity,top:1===d?"-="+n:"+="+c.expandedHeight},c.animSpeed,c.animEasing).find(".va-title").stop().animate({lineHeight:n+"px"},c.animSpeed,c.animEasing).end().find(".va-content").hide()):(a.data("expanded",!1),n=(c.accordionH-c.expandedHeight)/(c.visibleSlices-1),a.stop().animate({top:1===d?"-="+n:"+="+n},c.animSpeed,c.animEasing)):a.stop().animate({top:s},c.animSpeed,c.animEasing);a.data().position+=pos_increment})},canSlideUp:function(e,i){if(0!==e.eq(f.current).index())return!0},canSlideDown:function(e,i){if(e.eq(f.current+i.visibleSlices-1).index()!==f.totalSlices-1)return!0}},i={init:function(i){if(this.length){var d={accordionW:1e3,accordionH:450,visibleSlices:3,expandedHeight:350,animSpeed:250,animEasing:"jswing",animOpacity:.2,contentAnimSpeed:900,savePositions:!0};return this.each(function(){i&&x.extend(d,i);var e=x(this),n=e.find("div.va-slice"),a=e.find("span.va-nav-next"),t=e.find("span.va-nav-prev");f.sliceH=Math.ceil(d.accordionH/d.visibleSlices),f.totalSlices=n.length,d.expandedHeight>d.accordionH?d.expandedHeight=d.accordionH:d.expandedHeight<=f.sliceH&&(d.expandedHeight=f.sliceH+50),e.css({width:d.accordionW+"px",height:d.accordionH+"px"}),d.visibleSlices<f.totalSlices&&a.show(),n.each(function(e){x(this).css({top:e*f.sliceH+"px",height:f.sliceH+"px"}).data("position",e+1)}).children(".va-title").css("line-height",f.sliceH+"px"),n.bind("click.vaccordion",function(e){if(1<d.visibleSlices){var i=x(this);h.selectSlice(i,n,a,t,d)}}),a.bind("click.vaccordion",function(e){h.navigate(1,n,a,t,d)}),t.bind("click.vaccordion",function(e){h.navigate(-1,n,a,t,d)}),e.bind("mousewheel.vaccordion",function(e,i){return 0<i?h.navigate(-1,n,a,t,d):h.navigate(1,n,a,t,d),!1})})}}};x.fn.vaccordion=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void x.error("Method "+e+" does not exist on jQuery.vaccordion"):i.init.apply(this,arguments)}}(jQuery);